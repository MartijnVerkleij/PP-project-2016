%------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%------------------------------------------------

\documentclass[twoside]{report}

\usepackage{graphicx}

\usepackage{minted}

\usepackage{amsmath,amssymb,amsthm} % Mathematical Symbols, styles, etc

\usepackage[sc]{mathpazo} % Use the Palatino font
% Output encoding
\usepackage[T1]{fontenc} % Use 8-bit encoding that has 256 glyphs
% Input encoding
\usepackage[utf8]{inputenc} % UTF-8 character encoding stuff
\linespread{1.05} % Line spacing - Palatino needs more space between lines
\usepackage{microtype} % Slightly tweak font spacing for aesthetics

\usepackage[hmarginratio=1:1,top=32mm,columnsep=20pt]{geometry} % Document margins
\usepackage[hang, small,labelfont=bf,up,textfont=it,up]{caption} % Custom captions under/above floats in tables or figures
\usepackage{booktabs} % Horizontal rules in tables
\usepackage{float} % Required for tables and figures in the multi-column environment - they need to be placed in specific locations with the [H] (e.g. \begin{table}[H])
\usepackage{hyperref} % For hyperlinks in the PDF
\newcommand*{\fullref}[1]{\hyperref[{#1}]{\ref*{#1} (\nameref*{#1})}}
\newcommand*{\fullautoref}[1]{\hyperref[{#1}]{\autoref*{#1} (\nameref*{#1})}}

\usepackage{pdflscape} % For landscape pages

\usepackage{lettrine} % The lettrine is the first enlarged letter at the beginning of the text
\usepackage{paralist} % Used for the compactitem environment which makes bullet points with less space between them

\usepackage{titlesec} % Allows customization of titles
%\renewcommand\thesection{\Roman{section}} % Roman numerals for the sections
%\renewcommand\thesubsection{\Roman{subsection}} % Roman numerals for subsections
%\titleformat{\section}[block]{\large\scshape}{\thesection.}{1em}{} % Change the look of the section titles
%\titleformat{\subsection}[block]{\large}{\thesubsection.}{1em}{} % Change the look of the subsection titles

\usepackage{fancyhdr} % Headers and footers
\pagestyle{fancy} % All pages have headers and footers
\fancyhead{} % Blank out the default header
\fancyfoot{} % Blank out the default footer
\fancyhead[C]{M.F. Verkleij, T. Kerkhoven: \shorttitle} % Custom header text
\fancyfoot[RO,LE]{\thepage} % Custom footer text

% Bibliography
\usepackage[backend=bibtex, sorting=none]{biblatex}
\bibliography{references.bib}

% Appendices
\usepackage[toc,page]{appendix} % appendix

% Additional column type
\usepackage{array}
\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}}

% Indentation of list
\usepackage{changepage}
\newenvironment{mycompactdesc}{\begin{adjustwidth}{0.53cm}{}\begin{compactdesc}}{\end{compactdesc}\end{adjustwidth}}

%------------------------------------------------
%	TITLE SECTION
%------------------------------------------------

\newcommand{\articletitle}{Programming Paradigms Final Project: Building a Compiler in Haskell for the Sprockell}
\newcommand{\shorttitle}{PP Final Project}

\title{\vspace{-15mm}\fontsize{24pt}{10pt}\selectfont\textbf{\articletitle}} % Article title

\author{
\large
\textsc{Martijn Verkleij \& Tim Kerkhoven}\\[2mm] % Your name
\normalsize University of Twente \\ % Your institution
\normalsize \href{mailto:m.f.verkleij@student.utwente.nl}{m.f.verkleij@student.utwente.nl},
\href{mailto:t.kerkhoven@student.utwente.nl}{t.kerkhoven@student.utwente.nl}\\% Your email addresses
\normalsize s1466895 s1375253
}

\date{\today}

%------------------------------------------------

\begin{document}

\thispagestyle{empty}
\maketitle % Insert title


%------------------------------------------------
%	ARTICLE CONTENTS
%------------------------------------------------

%------------------------------------------------
\tableofcontents


%------------------------------------------------
\chapter{Introduction}
\label{introduction}
The language designed for this project is called Simple Haskell Language (SHL), with file extension \emph{.shl}.


%------------------------------------------------
\chapter{Summary}
\label{summary}
This chapter will give a summary of the features of SHL. 
\paragraph{Data types} SHL supports two types: integers and booleans. 
\paragraph{Simple expressions and variables} SHL supports denotations for primitive values of types as well as operations for (in)equality for values of types. SHL is strongly typed and all variables are initialised upon declaration. It also supports scoping with variable shadowing. The following expressions are supported:
\begin{compactitem}
	\item Parentheses
	\item Assignment
	\item Operation (with ==, !=, <>, \&\&, ||, <=, >=, <, >, +, -, *)
	\item Unary operation (with !, -)
	\item Variable
	\item Integer value
	\item Boolean value
\end{compactitem}
\paragraph{Basic statements} SHL supports the following statements: 
\begin{compactitem}
	\item Block
	\item Declaration
	\item If 
	\item While
	\item Call
	\item Fork 
	\item Join
	\item Print
	\item Expression
\end{compactitem}
\paragraph{Concurrency} SHL supports global variables, fork and join statements to implement concurrency.
\paragraph{Procedures} SHL supports basic procedures with call-by-reference.


%------------------------------------------------
\chapter{Problems \& Solutions}
\label{problems_and_solutions}
%TODO somewhere at the end

- Something about concurrency\\
- Something about call-by-reference\\
- Something about other stuff


%------------------------------------------------
\chapter{Detailed Language Description}
\label{detailed_language_description}
This chapter will describe every feature of SHL in detail: providing a basic description; information on the syntax with at least one example; usage information along with restrictions; a description of its effects and execution; and some general information on the generated code.

%\section{General/collection}
%\subsection{Feature}
%\subsubsection*{Syntax}
%\subsubsection*{Usage}
%\subsubsection*{Semantics}
%\subsubsection*{Code Generation}


\subsection{Program}
\label{def:program}
\subsubsection*{Syntax}
\texttt{[GLOBAL]\ldots [PROCEDURE]\ldots [STATEMENTS]\ldots}\\
\begin{mycompactdesc}
	\item[GLOBAL] Global variable declarations as defined in \fullref{def:global}
	\item[PROCEDURE] Procedures as defined in \fullref{def:procedure}
	\item[STATEMENTS] Statements as defined in \fullref{def:statements}
\end{mycompactdesc}
\paragraph{Example}
\begin{minted}[tabsize=4]{text}
global int number = 5;

procedure eq(int num1, int num2, bool out) {
	if ((num1 == num2)) {
		out = true;
	} else {
		out = false;
	}
}

int otherNumber = 6;
bool out;
eq(number, otherNumber, out);
print(out);
\end{minted}
\subsubsection*{Usage}
All files must follow the program syntax, and may only contain a single program.
\subsubsection*{Semantics}
A program is a collection of code which can be used to create an executable set of instructions. It is the root node of the Abstract Syntax Tree.
\subsubsection*{Code Generation}
%TODO Martijn


\subsection{Global}
\label{def:global}
\subsubsection*{Syntax}
\texttt{global <TYPE> <ID> [= <EXPRESSION>] ;}
\begin{mycompactdesc}
	\item[TYPE] A type as defined in \fullref{def:type}
	\item[ID] A string as defined by \fullref{def:variable}
	\item[EXPRESSION] An expression as defined in \fullref{def:expressions}
\end{mycompactdesc}
\paragraph{Examples}
\begin{minted}[tabsize=4]{text}
global bool flag = true;
global int number;
\end{minted}
\subsubsection*{Usage}
Used to declare global variables and an optional assignment.  The type of the expression must match the type of the global variable.
\subsubsection*{Semantics}
The global variable declaration reserves a space in shared memory and writes a value to it. All global variables are initialized to the default value (see \fullref{def:integer} and \fullref{def:boolean}) if no value is explicitly assigned.

Global variables are reachable from anywhere below its declaration in the code, in any thread. Beware, however, that the variable can be written to from any thread as well, and using the shared memory is significantly slower than using the local memory.
\subsubsection*{Code Generation}
%TODO Martijn


\subsection{Procedure}
\label{def:procedure}
\subsubsection*{Syntax}
\texttt{procedure <ID> ( [<TYPE> <VAR>] [, <TYPE> <VAR>]\ldots ) <STATEMENT>...}
\begin{mycompactdesc}
	\item[ID] A string as defined in \fullref{def:variable}
	\item[TYPE] A type as defined in \fullref{def:type}
	\item[VAR] A variable as defined in \fullref{def:variable}
	\item[STATEMENT] A statement as defined in \fullref{def:statements}
\end{mycompactdesc}
\paragraph{Examples}
\begin{minted}[tabsize=4]{text}
procedure empty() print(0);
procedure other(int num, bool flip) {
	while ((num > 0)) {
		num = --num;
		flip = !flip;
	}
	print(num, flip);
}
\end{minted}
\subsubsection*{Usage}
Used to declare a procedure. Because call-by-reference (see \fullref{def:call_by_reference}) is used, a variable passed as an argument can be used to write resulting values. One could also use the global variables (see \fullref{def:global}), as they are accessible from everywhere.
\subsubsection*{Semantics}
A procedure is section of code that can be executed from anywhere, using a call statement (see \fullref{def:call}) and passing it the appropriate number of arguments.
\subsubsection*{Code Generation}
%TODO Martijn


\section{Statements}
\label{def:statements}


\subsection{Declaration}
\subsubsection*{Syntax}
\texttt{<TYPE> <ID> [= <EXPRESSION>] ;}
\begin{mycompactdesc}
	\item[TYPE] A type as defined in \fullref{def:type}
	\item[ID] A string as defined in \fullref{def:variable}
	\item[EXPRESSION] An expression as defined in \fullref{def:expressions}
\end{mycompactdesc}
\paragraph{Examples}
\begin{minted}[tabsize=4]{text}
int number = (1+1);
bool flag;
\end{minted}
\subsubsection*{Usage}
Used to declare local variables and an optional assignment. The type of the expression must match the type of the variable.
\subsubsection*{Semantics} %TODO Martijn, check this
The variable declaration writes the value of the variable to the Activation Record of the current scope. All variables are initialized to the default value (see \fullref{def:integer} and \fullref{def:boolean}) if no value is explicitly assigned.
\subsubsection*{Code Generation}
%TODO Martijn


\subsection{If}
\label{def:if}
\subsubsection*{Syntax}
\texttt{if ( <EXPRESSION> ) <STATEMENT> [else <STATEMENT>]}
\begin{mycompactdesc}
	\item[EXPRESSION] An expression as defined in \fullref{def:expressions}
	\item[STATEMENT] A statement as defined in \fullref{def:statements}
\end{mycompactdesc}
\paragraph{Examples}
\begin{minted}[tabsize=4]{text}
if (flag) {
	// do something
}
if (flag) print(flag); else {
	// do something
}
\end{minted}
\subsubsection*{Usage}
Execute a section of code based on an expression. The type of this expression must be a boolean.
\subsubsection*{Semantics}
If the expression evaluates to \emph{true}, execute the first statement. If it evaluates to \emph{false}, execute the code after the first statement, which can be either the second statement or the code that comes after the if statement.
\subsubsection*{Code Generation}
%TODO Martijn


\subsection{While}
\label{def:while}
\subsubsection*{Syntax}
\texttt{while ( <EXPRESSION> ) <STATEMENT>}
\begin{mycompactdesc}
	\item[EXPRESSION] An expression as defined in \fullref{def:expressions}
	\item[STATEMENT] A statement as defined in \fullref{def:statements}
\end{mycompactdesc}
\paragraph{Examples}
\begin{minted}[tabsize=4]{text}
while (flag) {
	// do something
}
\end{minted}
\subsubsection*{Usage}
Execute a section of code while the expression is \emph{true}. The type of this expression must be a boolean.
\subsubsection*{Semantics}
If the expression evaluates to \emph{true}, execute the statement. Repeat this for as long as the expression keeps evaluating to \emph{true}.
\subsubsection*{Code Generation}
%TODO Martijn


\subsection{Fork}
\label{def:fork}
\subsubsection*{Syntax}
\texttt{fork <ID> ( [<EXPRESSION> [, <EXPRESSION>]\ldots] ) ;}
\begin{mycompactdesc}
	\item[ID] A string as defined by \fullref{def:variable}
	\item[EXPRESSION] An expression as defined by \fullref{def:expression}
\end{mycompactdesc}
\paragraph{Examples}
\begin{minted}[tabsize=4]{text}
fork proc0();
fork proc1(flag);
fork proc2(5, flag = true);
\end{minted}
\subsubsection*{Usage}
Run a procedure on a separate thread. The expression types must match the types defined during the procedure declaration (see \fullref{def:procedure}).
\subsubsection*{Semantics}
Writes the argument to shared memory and tells the thread pool to start parallel execution of the procedure.

Beware, if more procedures are given to the thread pool than there are threads, fork may have to wait for a thread to finish its work before continuing execution.
\subsubsection*{Code Generation}
%TODO Martijn


\subsection{Join}
\label{def:join}
\subsubsection*{Syntax}
\texttt{join ;}
\paragraph{Example}
\begin{minted}[tabsize=4]{text}
join;
\end{minted}
\subsubsection*{Usage}
Ensures all thread have are done before continuing. May only be called in the main thread.
\subsubsection*{Semantics}
Blocks execution of the main thread until all other threads have finished their work.
\subsubsection*{Code Generation}
%TODO Martijn


\subsection{Call}
\label{def:call}
\subsubsection*{Syntax}
\texttt{<ID> ( [<EXPRESSION> [, <EXPRESSION>]\ldots] ) ;}
\begin{mycompactdesc}
	\item[ID] A string as defined by \fullref{def:variable}
	\item[EXPRESSION] An expression as defined by \fullref{def:expression}
\end{mycompactdesc}
\paragraph{Examples}
\begin{minted}[tabsize=4]{text}
proc0();
proc1(flag);
proc2(5, flag = true);
\end{minted}
\subsubsection*{Usage}
Execute the called procedure. The expressions must have the same types as the procedure as defined in its declaration (see \fullref{def:procedure})
\subsubsection*{Semantics}
Go to the procedure code and execute the procedure with the expressions, then return to the call.
\subsubsection*{Code Generation}
%TODO Martijn


\subsection{Expression}
\label{def:expression_statement}
\subsubsection*{Syntax}
\texttt{<EXPRESSION> ;}
\begin{mycompactdesc}
	\item[EXPRESSION] An expression as defined in \fullref{def:expressions}
\end{mycompactdesc}
\paragraph{Examples}
\begin{minted}[tabsize=4]{text}
a = (5 + (--6));
\end{minted}
\subsubsection*{Usage}
Allows expressions to be executed as statements, mostly for the purpose of enabling an assignment (see \fullref{def:assignment}) as a statement, since an assignment is an expression.
\subsubsection*{Semantics}
Execute the expression, this generally has no effects, except for an assignment.
\subsubsection*{Code Generation}
%TODO Martijn


\subsection{Block}
\label{def:block}
\subsubsection*{Syntax}
\texttt{}
\begin{mycompactdesc}
	
\end{mycompactdesc}
\paragraph{Examples}
\begin{minted}[tabsize=4]{text}
\end{minted}
\subsubsection*{Usage}
\subsubsection*{Semantics}
\subsubsection*{Code Generation}
%TODO Martijn


\subsection{Print}
\label{def:print}
\subsubsection*{Syntax}
\texttt{}
\begin{mycompactdesc}
	
\end{mycompactdesc}
\paragraph{Examples}
\begin{minted}[tabsize=4]{text}
\end{minted}
\subsubsection*{Usage}
\subsubsection*{Semantics}
\subsubsection*{Code Generation}
%TODO Martijn


%------------------------------------------------
\chapter{Description of the Software}
\label{description_of_the_software}


%------------------------------------------------
\chapter{Test Plan \& Results}
\label{test_plan_and_results}


%------------------------------------------------
\chapter{Personal Evaluation}
\label{personal_evaluation}
\section{Martijn}
%TODO somewhere at the end by Martijn
\section{Tim}
%TODO somewhere at the end by Tim


%------------------------------------------------
%	REFERENCE LIST
%------------------------------------------------
\printbibliography
\label{references}
%bibliography{references}

%------------------------------------------------
%	APPENDICES
%------------------------------------------------
\begin{appendices}
\label{appendices}


%------------------------------------------------
\chapter{Grammar Specification}
\label{grammar_specification}
\begin{landscape}
\inputminted[firstline=66, lastline=111, tabsize=4]{haskell}{../Grammar.hs}
\end{landscape}


%------------------------------------------------
\chapter{Extended Test Program}
\label{extended_test_program}
\section{TODO Listing of test program}
\section{TODO generated target code of test program}
\section{TODO one or more example executions showing correct functioning of the generated code}



\end{appendices}

\end{document}
